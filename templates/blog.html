{% extends "base.html" %}

{% block title %}Blog - Sophie's Garden{% endblock %}

{% block content %}
    <div class="space-y-8">
        <div class="text-center">
            <h1 class="font-display text-4xl md:text-5xl font-bold gradient-text mb-4">üìù Garden Blog</h1>
            <p class="text-lg text-base-content opacity-80 max-w-2xl mx-auto">
                Tips, tricks, and inspiration for creating and maintaining your perfect garden.
            </p>
            <!-- Search and Tag Filters -->
            <div class="mt-6 flex flex-col items-center gap-4">
                <form method="GET" action="{{ url_for('blog') }}" class="join">
                    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search posts..." class="input input-bordered join-item w-72" />
                    {% if tag %}
                        <input type="hidden" name="tag" value="{{ tag }}" />
                    {% endif %}
                    <button class="btn btn-primary join-item">Search</button>
                    {% if q or tag %}
                        <a href="{{ url_for('blog') }}" class="btn join-item">Clear</a>
                    {% endif %}
                </form>
                {% if tags %}
                <div class="flex flex-wrap justify-center gap-2">
                    {% for t in tags %}
                        <a href="{{ url_for('blog', tag=t, q=q) }}" class="btn btn-sm rounded-full {{ 'btn-primary' if t == tag else 'btn-outline btn-primary' }}">#{{ t }}</a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% if posts %}
                {% for post in posts %}
                    <article class="card garden-glass hover-lift">
                        <figure class="h-48 w-full overflow-hidden rounded-t-xl">
                            {% if post.cover_image_url %}
                                <img src="{{ post.cover_image_url }}" alt="{{ post.title }}" class="w-full h-48 object-cover">
                            {% else %}
                                <div class="h-48 w-full bg-gradient-to-br from-pink-200 to-purple-300 flex items-center justify-center text-5xl">ü™¥</div>
                            {% endif %}
                        </figure>
                        <div class="card-body">
                            <div class="flex items-center gap-2 text-xs opacity-70">
                                {% if post.author %}<span>By {{ post.author }}</span>{% endif %}
                                <span>‚Ä¢</span>
                                <span>{{ post.published_at.strftime('%b %d, %Y') if post.published_at else '' }}</span>
                            </div>
                            <h2 class="card-title text-primary">{{ post.title }}</h2>
                            {% if post.excerpt %}
                                <p class="text-base-content opacity-80 text-sm mb-3 line-clamp-2">{{ post.excerpt }}</p>
                            {% else %}
                                <p class="text-base-content opacity-80 text-sm mb-3 line-clamp-2">{{ (post.content or '')[:160] }}{% if post.content and post.content|length > 160 %}...{% endif %}</p>
                            {% endif %}
                            <div class="flex flex-wrap gap-1 mb-4">
                                {% for tag in (post.tags or '').split(',') if tag.strip() %}
                                    <span class="badge badge-outline">{{ tag.strip() }}</span>
                                {% endfor %}
                            </div>
                            <div class="card-actions">
                                <a href="{{ url_for('blog_detail', post_id=post.id) }}" class="btn btn-primary btn-sm">Read More</a>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            {% else %}
                <div class="col-span-full text-center py-12 opacity-70">
                    No posts yet. Check back soon!
                </div>
            {% endif %}
        </div>

        {% if pagination %}
        <div class="text-center mt-8">
            <div class="join">
                {% if pagination.has_prev %}
                    <a href="{{ url_for('blog', page=pagination.prev_num) }}" class="btn btn-outline btn-primary join-item">Prev</a>
                {% else %}
                    <button class="btn join-item" disabled>Prev</button>
                {% endif %}
                {% for p in range(1, pagination.pages + 1) %}
                    {% if p == pagination.page %}
                        <a href="{{ url_for('blog', page=p) }}" class="btn btn-primary join-item">{{ p }}</a>
                    {% else %}
                        <a href="{{ url_for('blog', page=p) }}" class="btn btn-outline btn-primary join-item">{{ p }}</a>
                    {% endif %}
                {% endfor %}
                {% if pagination.has_next %}
                    <a href="{{ url_for('blog', page=pagination.next_num) }}" class="btn btn-outline btn-primary join-item">Next</a>
                {% else %}
                    <button class="btn join-item" disabled>Next</button>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="text-center mt-8">
            <h2 class="font-display text-2xl md:text-3xl font-bold gradient-text mb-4">Subscribe to Our Garden Tips</h2>
            <p class="text-base-content opacity-80 mb-6">Get weekly gardening tips and seasonal advice delivered to your inbox.</p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center max-w-md mx-auto">
                <input type="email" placeholder="Your email address" class="input input-bordered flex-1" />
                <button class="btn btn-primary">Subscribe</button>
            </div>
        </div>
    </div>
{% endblock %}